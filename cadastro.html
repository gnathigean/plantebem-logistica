<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/tema.css" /> 

  <title>P√°gina de Cadastro Exclusiva</title>

  <style>
    /* Estilos b√°sicos para o cont√™iner, use o tema.css se preferir */
    .container {
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }
    
    /* Oculta o conte√∫do principal por padr√£o */
    #main-content {
      display: none; 
    }

    /* Estilo para a mensagem de erro/acesso negado */
    #acesso-negado {
      color: red;
      text-align: center;
      padding: 20px;
      border: 1px solid #ffdddd;
      background-color: #ffeeee;
      margin-top: 50px;
    }
  </style>
</head>

<body>
  
  <div class="fixed-nav">
    <a href="menu.html" class="botao-menu">‚Üê Menu</a> 
    <button id="logout-button" style="display: none;">Sair</button>
  </div>
    
      <div id="loading" class="container" style="text-align: center;">
    <p>Verificando acesso...</p>
  </div>
    
  <div id="acesso-negado" style="display: none;">
    <h2>Acesso Negado üõë</h2>
    <p>Esta p√°gina √© exclusiva para o administrador. Por favor, fa√ßa login com a conta correta.</p>
  </div>

    <div id="main-content" class="container">
    <h1>FORMUL√ÅRIO DE CADASTRO ADMINISTRATIVO</h1>
    <form id="meu-formulario">
      <label for="nome-usuario">Nome do Novo Usu√°rio:</label>
      <input type="text" name="nome-usuario" id="nome-usuario" required />
            
      <label for="email-usuario">E-mail do Novo Usu√°rio:</label>
      <input type="email" name="email-usuario" id="email-usuario" required />
            
      <label for="senha-usuario">Senha Tempor√°ria:</label>
      <input type="password" name="senha-usuario" id="senha-usuario" required />
            
            <br><br>
      <input type="submit" value="Criar Novo Usu√°rio" />
    </form>
    <div id="status" class="mensagem-status"></div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    // Importa a fun√ß√£o para criar usu√°rio com e-mail e senha
    import { createUserWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js';
    
    // ‚ö†Ô∏è 1. COLOQUE SUAS CONFIGURA√á√ïES FIREBASE AQUI ‚ö†Ô∏è
    const firebaseConfig = {
      apiKey: "AIzaSyD8GjaS3tuDpSvBl2-bpa-QXIKTqq80Mn4",
      authDomain: "login-com-dados.firebaseapp.com",
      projectId: "login-com-dados",
      storageBucket: "login-com-dados.firebasestorage.app",
      messagingSenderId: "75556023458",
      appId: "1:75556023458:web:9f1362d0597603c0f37bfb",
      measurementId: "G-W9LRT99579"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    
    // üö® 2. COLOQUE SEU UID PESSOAL AQUI üö®
    // Voc√™ pode encontrar seu UID no console do Firebase > Authentication
    const ADMIN_UID = "O02XwNu2KSNCCk0xCvdBE2YxW9G2"; 
    
    const mainContent = document.getElementById("main-content");
    const loadingDiv = document.getElementById("loading");
    const acessoNegadoDiv = document.getElementById("acesso-negado");
    const logoutButton = document.getElementById("logout-button");
    const formulario = document.getElementById("meu-formulario");
    const statusDiv = document.getElementById("status");

    // Fun√ß√£o para mostrar status (sucesso/erro)
    function showStatus(text, type) {
      statusDiv.textContent = text;
      statusDiv.className = `mensagem-status ${type}`; // Assumindo que voc√™ tem essas classes no tema.css
    }

    // --- L√ìGICA DE AUTENTICA√á√ÉO E VERIFICA√á√ÉO DE UID ---
    onAuthStateChanged(auth, (user) => {
      loadingDiv.style.display = 'none'; // Esconde a mensagem de carregamento

      if (user) {
        // Usu√°rio logado
        logoutButton.style.display = 'inline-block';

        if (user.uid === ADMIN_UID) {
          // UID corresponde ao admin: Concede acesso
          mainContent.style.display = 'block'; 
          acessoNegadoDiv.style.display = 'none';
        } else {
          // UID diferente do admin: Acesso negado
          mainContent.style.display = 'none';
          acessoNegadoDiv.style.display = 'block';
        }
      } else {
        // Ningu√©m logado: Redireciona para a p√°gina de login
        window.location.href = 'index.html'; 
      }
    });
    
    // FUNCIONALIDADE DO BOT√ÉO DE SAIR
    logoutButton.addEventListener('click', () => {
      signOut(auth).then(() => {
        window.location.href = 'index.html';
      }).catch((error) => {
        console.error("Erro ao deslogar:", error);
      });
    });

    // --- L√ìGICA DE ENVIO DO FORMUL√ÅRIO DE CADASTRO ---
    formulario.addEventListener("submit", async function (evento) {
      evento.preventDefault();

      const email = document.getElementById("email-usuario").value;
      const password = document.getElementById("senha-usuario").value;
      
      if (auth.currentUser.uid !== ADMIN_UID) {
        showStatus("Erro: Voc√™ n√£o tem permiss√£o para cadastrar usu√°rios.", 'error');
        return;
      }
      
      showStatus("Cadastrando novo usu√°rio...", 'message');

      try {
        // ‚ö†Ô∏è IMPORTANTE: O Firebase precisa que o administrador (voc√™) esteja 
        // logado para que esta fun√ß√£o funcione.
        
                // A CRIA√á√ÉO DE USU√ÅRIO DIRETO DO CLIENTE (NA WEB) √â PERIGOSA!
                // Este m√©todo (createUserWithEmailAndPassword) far√° login no novo 
                // usu√°rio e deslogar√° o Admin. Para uso real, √© MELHOR 
                // usar Cloud Functions ou Admin SDK em um servidor.
                
                // Para o seu prop√≥sito de teste/simples, vamos usar a cria√ß√£o
                // b√°sica, mas √© recomendado recarregar a p√°gina para re-verificar o Admin.
                
        await createUserWithEmailAndPassword(auth, email, password);
                
        showStatus(`Usu√°rio ${email} cadastrado com sucesso!`, 'success');
        formulario.reset();

      } catch (error) {
        // Trata erros comuns do Firebase
                let errorMessage = 'Erro ao cadastrar usu√°rio.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'O e-mail j√° est√° sendo usado por outra conta.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'A senha deve ter pelo menos 6 caracteres.';
                } else {
                    console.error("Erro detalhado:", error);
                }
        showStatus(errorMessage, 'error');
      }
    });

  </script>
</body>
</html>